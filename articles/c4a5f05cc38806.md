---
title: "JsonSerializable ã® Tips ï¼ˆãŠã¾ã‘ã§ freezed ã‚‚ï¼‰"
emoji: "ğŸ•"
type: "tech"
topics: ["flutter", "dart", "jsonserializabl", "jsonannotation", "buildrunner"]
published: true
---

## ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ã€‚[ã‚„ã¾ãŸã¤](https://twitter.com/yamatatsu109_ja)ã§ã™ï¼
ã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦åƒã„ã¦ãŠã‚Šã€ç¾åœ¨ Flutter ã§ã®é–‹ç™ºã«ãƒãƒã£ã¦ã„ã¾ã™ã€‚

JsonSerializable ã‚’ä½¿ã£ãŸé–‹ç™ºã‚’ã—ã¦ã„ãŸã®ã§ã™ãŒã€æœ€è¿‘ `fieldRename: FieldRename.snake` ã‚’çŸ¥ã£ã¦ã€æ­“å–œã—ã€ä»Šã¾ã§ã®æ‰‹æ‰“ã¡ã¯ä½•ã ã£ãŸã‚“ã ã¨å°‘ã—ã ã‘æ‚²ã—ããªã‚Šã¾ã—ãŸã€‚ã€‚ã€‚
ã„ã¤ã‚‚ `@JsonKey(name: 'hoge_id')` ã¨è¨˜è¿°ã—ã¦ã„ãŸã®ã«ãã‚ŒãŒå¿…è¦ãªããªã‚Šã¾ã—ãŸï¼

:::message alert
ä»–ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢æ–¹ãŒè‡ªåˆ†ã¨åŒã˜è½ã‚’è¸ã¾ãªã„ã‚ˆã†ã«ã€ã“ã®è¨˜äº‹ã‚’æ®‹ã—ã¦ãŠãã¾ã™ğŸš€
:::


## JsonSerializable

[JsonSerializable](https://pub.dev/packages/json_serializable) ã¨ã¯ã€json ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆclassï¼‰ ã¸ã®å¤‰æ›ã€ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ json ã¸ã®å¤‰æ›ã‚’ç°¡å˜ã«ã—ã¦ãã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ [JsonSerializable](https://pub.dev/packages/json_serializable) ã® Example ã§ã™ã€‚
@JsonSerializable() ã®ã¨ã“ã‚ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒ‡å®šã§ãã¾ã™ã€‚Example ã§ã¯ `nullable: false` ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```dart
import 'package:json_annotation/json_annotation.dart';

part 'example.g.dart';

@JsonSerializable(nullable: false)
class Person {
  final String firstName;
  final String lastName;
  final DateTime dateOfBirth;
  Person({this.firstName, this.lastName, this.dateOfBirth});
  factory Person.fromJson(Map<String, dynamic> json) => _$PersonFromJson(json);
  Map<String, dynamic> toJson() => _$PersonToJson(this);
}
```

### JsonSerializable ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

@JsonSerializable ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã¯ã„ãã¤ã‹ç¨®é¡ãŒã‚ã‚Šã€æœ€è¿‘çŸ¥ã£ãŸ `fieldRename: FieldRename.snake` ã‚‚ãã®ä¸€ã¤ã§ã™ã€‚
æ°—ã«ãªã£ãŸã‚‚ã®ã ã‘ç´¹ä»‹ã—ã¾ã™ã€‚

1. **cheked** 
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `false` 
true ã«ã™ã‚‹ã¨ fromJson ä¸­ã§ä¾‹å¤–ãŒã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸæ™‚ã«ã€CheckedFromJsonException ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€å‹ã‚’é–“é•ã£ã¦æŒ‡å®šã—ã¦ã—ã¾ã£ãŸæ™‚ãªã©ã€fromJson ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€ã©ã“ã®å‹ãŒé–“é•ã£ãŸã®ã‹åˆ†ã‹ã‚‰ãªããªã‚Šã¾ã™ã€‚checked ã‚’ true ã«ã—ã¦ãŠãã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã©ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§è½ã¡ãŸã®ã‹ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚
2. **createFactory**
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `true`
true ã®å ´åˆã€ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã« _$ã€‡ã€‡FromJson ãƒ¡ã‚½ãƒƒãƒ‰ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
3. **createToJson**
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `true`
true ã«ã™ã‚‹ã¨ã€ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã« toJson ãƒ¡ã‚½ãƒƒãƒ‰ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
4. **disallowUnrecognizedKeys**
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `false`
false ã®æ™‚ã¯èªè­˜ã§ããªã‹ã£ãŸã‚­ãƒ¼ã‚’ç„¡è¦–ã—ã¾ã™ã€‚
true ã®æ™‚ã¯èªè­˜ã§ããªã„ã‚­ãƒ¼ãŒã‚ã£ãŸå ´åˆã€UnrecognizedKeysException ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚
false ã®è¨­å®šã§è‰¯ã„ã‹ã¨æ€ã„ã¾ã™ã€‚
5. **field_rename**
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `none`
enum ã§å®šç¾©ã—ã¦ã‚ã‚Šã€ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã€ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã€ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚
ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ã¯ã¨ã¦ã‚‚å¬‰ã—ã„ã§ã™â˜ºï¸
ã¾ãŸã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ç›´æ¥ @JsonKey(name: 'user_id') ã‚’è¨˜è¿°ã—ã¦ã„ã‚‹ã¨ã€@JsonKey ã‚’å„ªå…ˆã—ã¦ã€json ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¾ã™ã€‚
ä»¥ä¸‹ã¯ã€FieldRename ã® enum ã®å®šç¾©ã§ã™ã€‚

```dart
enum FieldRename {
  /// Use the field name without changes.
  none,

  /// Encodes a field named `kebabCase` with a JSON key `kebab-case`.
  kebab,

  /// Encodes a field named `snakeCase` with a JSON key `snake_case`.
  snake,

  /// Encodes a field named `pascalCase` with a JSON key `PascalCase`.
  pascal
}

```

### JsonSerializable ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æŒ‡å®šã®ä»•æ–¹

#### class ã« JsonSerializable() ã‚’è¨˜è¿°

 ```dart
@JsonSerializable(
  checked: true,
  fieldRename: FieldRename.snake,
)
class User {
  ~~~~
}
```

#### `build.yaml` ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒˆãƒƒãƒ—ã®éšå±¤ã«é…ç½®

`build.yaml` ã‚’é…ç½®ã—ã¦ãŠãã¨ã€å…¨ã¦ã® JsonSerializable ã® class ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚
ã¡ãªã¿ã«ãƒˆãƒƒãƒ—ã®éšå±¤ã¨ã¯ã€  `pubspec.yaml` ãŒã‚ã‚‹ã¨ã“ã‚ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/rfgutgxjqdzwb605wnc9t6j1khxi)

[JsonSerializable](https://pub.dev/packages/json_serializable) ã® `Build configuration` ã®æ¬„ã«ã‚‚è©³ç´°ãŒè¨˜è¿°ã—ã¦ã‚ã‚Šã¾ã™ã€‚
è‡ªåˆ†ã¯ä»Šåº¦ã‹ã‚‰ä»¥ä¸‹ã® `build.yaml` ã‚’é…ç½®ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ï¼ï¼ï¼

```yaml:build.yaml
targets:
  $default:
    builders:
      json_serializable:
        options:
          # Options configure how source code is generated for every
          # `@JsonSerializable`-annotated class in the package.
          #
          # The default value for each is listed.
          any_map: false
          checked: true  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰å¤‰æ›´
          create_factory: true
          create_to_json: true
          disallow_unrecognized_keys: false
          explicit_to_json: false
          field_rename: snake # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰å¤‰æ›´
          generic_argument_factories: false
          ignore_unannotated: false
          include_if_null: true
          nullable: true
```

:::message
å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã« @JsonSerializable ã‚’æ›¸ãã®ã¯é¢å€’ãªã®ã§ã€ `build.yaml` ã‚’é…ç½®ã™ã‚‹ã®ãŒãŠã™ã™ã‚ï¼
:::


### ãŠã¾ã‘ freezedç·¨

freezed ã‚’ä½¿ã£ã¦ã„ã¦ã‚‚ `build.yaml` ã‚’é…ç½®ã—ã¦ã€ snakeã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã§ãã¾ã™ï¼


freezed ã§ã¯ @JsonSerializable ã‚’æŒ‡å®šã™ã‚‹ç®‡æ‰€ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã®ä¸Šã«ãªã‚Šã¾ã™ã€‚
```dart
@freezed
abstract class Example with _$Example {
  @JsonSerializable(explicit_to_json: true)
  factory Example(@JsonKey(name: 'my_property') SomeOtherClass myProperty) = _Example;

  factory Example.fromJson(Map<String, dynamic> json) => _$ExampleFromJson(json);
}
```

`@JsonKey` ã‚‚æŒ‡å®šã§ãã¾ã™!
```dart
@freezed
abstract class Example with _$Example {
  factory Example(@JsonKey(name: 'my_property') String myProperty) = _Example;

  factory Example.fromJson(Map<String, dynamic> json) => _$ExampleFromJson(json);
}
```



### çµ‚ã‚ã‚Šã«

JsonSerializable ã®èª¬æ˜ã‚’ã¡ã‚ƒã‚“ã¨è¦‹ã¦ãŠã‘ã°ã€`fieldRename: FieldRename.snake` ã«ã‚‚æ—©ãæ°—ã¥ã‘ãŸã®ã«ãªï¼ï¼ï¼ã¨æ€ã„ã¾ã—ãŸãŒã€ã„ã‚ã„ã‚èª¿ã¹ã‚‹ãã£ã‹ã‘ã«ãªã£ãŸã—ã€ã“ã‚Œã‹ã‚‰ã®é–‹ç™ºãŒã‚ˆã‚Šä¸Šæ‰‹ãã„ãã®ã§å•é¡Œãªã„ã§ã™ï¼
Flutter æ¥½ã—ã„ï¼ï¼ï¼

ã¿ãªã•ã‚“ã® Tips ã‚‚çŸ¥ã‚ŠãŸã„ã®ã§è‰¯ã‹ã£ãŸã‚‰ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ï¼
é–“é•ã£ã¦ã„ã‚‹ç®‡æ‰€ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€æ•™ãˆã¦ã„ãŸã ããŸã„ã§ã™ï¼
èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

åˆã‚ã¦ã® Zenn ã¸ã®æŠ•ç¨¿ã§ã—ãŸãŒã€æ›¸ãã‚„ã™ãã¦è‰¯ã„ã§ã™ã­â˜ºï¸